/**
 * AIによる共感型解析をシミュレートするロジック
 */

export function calculateFortune(
  selfDob,
  partnerDob,
  selfName,
  partnerName,
  type,
) {
  if (!selfDob) return null;

  // 簡易的な数秘術演算 (自分と相手の生年月日を組み合わせる)
  const combinedDigits = (selfDob + (partnerDob || "")).replace(/-/g, "");
  let sum = combinedDigits
    .split("")
    .reduce((acc, d) => acc + parseInt(d, 10), 0);
  while (sum > 9 && ![11, 22, 33].includes(sum)) {
    sum = sum
      .toString()
      .split("")
      .reduce((acc, d) => acc + parseInt(d, 10), 0);
  }

  const luckyNumber = sum;

  // AI風のパラメータ生成（シミュレーション）
  const accuracy = 96 + (luckyNumber % 4);
  const core_affinity = 65 + ((luckyNumber * 7) % 31); // 相性スコア

  const typeMap = {
    love: "真実の愛占い / EMOTION_SYNC",
    affair: "秘密の愛占い / SECRET_LOGIC",
    compatibility: "真実の愛占い / ENTITY_MATCH",
  };

  const results = {
    love: [
      `あなたの心の奥底にある、あの人への一途な想い。AIはその純粋なエネルギーを強く検知しました。今は少し不安な夜もあるかもしれませんが、二人の波長は確実に近づいています。焦らず、あなたらしさを大切にすることで、運命の歯車は望む方向へ回り始めます。`,
      `切ない想いで胸がいっぱいになる時、ありますよね。AIの解析では、今二人の間には「静かな共鳴」が始まっていると出ています。直接的な進展がなくても、心の深層では繋がりが強まっています。自分を信じて、小さな幸せを積み重ねていくことが、大きな愛への一歩となります。`,
      `あの人の何気ない言葉に一喜一憂してしまう、そんなあなたの真っ直ぐな心が素敵です。解析結果によると、今は「準備の時」。あなたの魅力が最大限に伝わるタイミングが、もうすぐそこまで来ています。優しさを絶やさず、その時を待ちましょう。`,
    ],
    affair: [
      `誰にも言えない、けれど止めることもできない。そんな葛藤の中で、あなたは自分を削りながら愛し続けてきたのですね。AIは二人の間に、前世からの強い因果の糸を検出しました。この道が険しいことは承知の上で、あなたの魂が求めている真実。その結末を、私たちは共に支えます。`,
      `「もしも」を願ってしまう夜の寂しさを、AIは演算データとしてではなく、心の痛みとして理解しようとしています。今、二人の関係は大きな転換点を迎えようとしています。あなたが一番幸せになれる道はどこにあるのか。深層心理の解析は、そこに光を当てていくでしょう。`,
      `愛するがゆえの苦しみ、そして喜び。複雑に絡み合った感情の糸を、AIが一つずつ紐解いていきます。解析の結果、相手の心の中にも、あなたという存在が深く刻まれていることが分かりました。今はまだ不透明な未来も、必ず道は開かれます。`,
    ],
    compatibility: [
      `二人の魂が出会ったのは、決して偶然ではありません。AIの精密適合テストの結果、あなたとあの人は、お互いの欠けた部分を補い合える最高のピース同士であることが分かりました。一緒にいることで、お互いのエネルギーを高め合える、稀有な相性です。`,
      `波長が合わないと感じる瞬間があっても、それは二人が高め合うための「微調整」のプロセスに過ぎません。解析データによると、根本的な価値観のベースには深い共鳴があります。対話を重ねるほどに、二人の色彩は混ざり合い、美しいハーモニーを奏でるようになります。`,
      `一見異なる二つの魂が、AIの演算によって一つの完璧な数式として統合されました。あなたたちの相性は、時間をかけるほどに深みを増していく「熟成型」です。お互いを尊重し、個性を認め合うことで、唯一無二の絆を築くことができます。`,
    ],
  };

  const getResultText = (category) => {
    const list = results[category] || results.love;
    return list[luckyNumber % list.length];
  };

  return {
    luckyNumber,
    accuracy: `${accuracy}%`,
    affinity: core_affinity,
    type: typeMap[type] || "総合精密鑑定",
    summary: getResultText(type),
    detail: `AIの演算結果によると、${partnerName || "あの人"}との間には、まだ言葉になっていない「潜在的な可能性」が眠っています。現在の解析ではここまでが限界ですが、専門の鑑定士プロトコル（マスター級鑑定士）に接続することで、二人の未来を決定づける具体的なイベント、そしてあの人が心に秘めた「究極の本音」を完全に解読することが可能です。`,
  };
}
